<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor CRM & Pipeline Tracker - P3 Funding Mastery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #ffffff;
            color: #000000;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #000;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .header p {
            font-size: 14px;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 20px;
            border: 1px solid #000;
            text-align: center;
            background: #f9f9f9;
        }

        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 12px;
            opacity: 0.7;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #000;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-filter {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-filter input,
        .search-filter select {
            padding: 8px 12px;
            border: 1px solid #000;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .btn {
            padding: 10px 20px;
            background: #000;
            color: #fff;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #333;
        }

        .btn-secondary {
            background: #fff;
            color: #000;
            border: 1px solid #000;
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .investors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .investor-card {
            border: 1px solid #000;
            padding: 20px;
            background: #fff;
            transition: all 0.3s;
        }

        .investor-card:hover {
            box-shadow: 5px 5px 0px #000;
            transform: translate(-2px, -2px);
        }

        .investor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .investor-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .investor-info p {
            font-size: 12px;
            opacity: 0.7;
        }

        .stage-badge {
            padding: 4px 8px;
            font-size: 10px;
            border: 1px solid #000;
            background: #f0f0f0;
        }

        .stage-badge.warm {
            background: #fff3cd;
        }

        .stage-badge.hot {
            background: #d4edda;
        }

        .stage-badge.cold {
            background: #f8d7da;
        }

        .investor-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .interaction-timeline {
            margin-bottom: 15px;
        }

        .timeline-item {
            padding: 8px 0;
            border-left: 2px solid #000;
            padding-left: 15px;
            margin-bottom: 10px;
            position: relative;
            font-size: 12px;
        }

        .timeline-item:before {
            content: '';
            width: 8px;
            height: 8px;
            background: #000;
            position: absolute;
            left: -5px;
            top: 12px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .card-actions button {
            flex: 1;
            min-width: 80px;
            padding: 6px 12px;
            font-size: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 30px;
            border: 2px solid #000;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #000;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .pipeline-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .pipeline-table th,
        .pipeline-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #000;
            font-size: 12px;
        }

        .pipeline-table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .pipeline-table tbody tr:hover {
            background: #f9f9f9;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            border: 1px solid #000;
            background: #f0f0f0;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: #000;
            transition: width 0.3s;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analytics-card {
            border: 1px solid #000;
            padding: 20px;
        }

        .export-section {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #000;
            background: #f9f9f9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .investors-grid {
                grid-template-columns: 1fr;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-filter {
                justify-content: center;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Investor CRM & Pipeline Tracker</h1>
            <p>Track relationships, manage communications, and optimize your funding pipeline with systematic investor relationship management</p>
        </div>

        <div class="stats-dashboard">
            <div class="stat-card">
                <h3 id="totalInvestors">0</h3>
                <p>Total Investors</p>
            </div>
            <div class="stat-card">
                <h3 id="activeDeals">0</h3>
                <p>Active Deals</p>
            </div>
            <div class="stat-card">
                <h3 id="totalCommitted">â‚¹0</h3>
                <p>Total Committed</p>
            </div>
            <div class="stat-card">
                <h3 id="avgResponseTime">0</h3>
                <p>Avg Response Time (Days)</p>
            </div>
            <div class="stat-card">
                <h3 id="conversionRate">0%</h3>
                <p>Conversion Rate</p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('investors')">Investors Database</button>
            <button class="tab" onclick="switchTab('pipeline')">Deal Pipeline</button>
            <button class="tab" onclick="switchTab('interactions')">Interaction Log</button>
            <button class="tab" onclick="switchTab('analytics')">Analytics</button>
        </div>

        <!-- Investors Database Tab -->
        <div id="investors" class="tab-content active">
            <div class="action-bar">
                <div class="search-filter">
                    <input type="text" id="searchInvestors" placeholder="Search investors..." onkeyup="filterInvestors()">
                    <select id="stageFilter" onchange="filterInvestors()">
                        <option value="">All Stages</option>
                        <option value="research">Research</option>
                        <option value="contacted">Contacted</option>
                        <option value="meeting_scheduled">Meeting Scheduled</option>
                        <option value="pitch_sent">Pitch Sent</option>
                        <option value="due_diligence">Due Diligence</option>
                        <option value="term_sheet">Term Sheet</option>
                        <option value="closed">Closed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <select id="typeFilter" onchange="filterInvestors()">
                        <option value="">All Types</option>
                        <option value="angel">Angel Investor</option>
                        <option value="vc">VC Fund</option>
                        <option value="family_office">Family Office</option>
                        <option value="government">Government</option>
                        <option value="corporate">Corporate VC</option>
                    </select>
                </div>
                <button class="btn" onclick="openAddInvestorModal()">+ Add Investor</button>
            </div>

            <div class="investors-grid" id="investorsGrid">
                <!-- Investor cards will be populated here -->
            </div>
        </div>

        <!-- Deal Pipeline Tab -->
        <div id="pipeline" class="tab-content">
            <div class="action-bar">
                <h3>Active Deal Pipeline</h3>
                <button class="btn" onclick="addDeal()">+ Add Deal</button>
            </div>

            <table class="pipeline-table">
                <thead>
                    <tr>
                        <th>Investor</th>
                        <th>Amount</th>
                        <th>Stage</th>
                        <th>Probability</th>
                        <th>Expected Close</th>
                        <th>Last Contact</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="pipelineTable">
                    <!-- Pipeline data will be populated here -->
                </tbody>
            </table>
        </div>

        <!-- Interactions Log Tab -->
        <div id="interactions" class="tab-content">
            <div class="action-bar">
                <h3>Communication Timeline</h3>
                <button class="btn" onclick="logInteraction()">+ Log Interaction</button>
            </div>

            <div id="interactionsList">
                <!-- Interactions will be populated here -->
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Pipeline Health</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="pipelineHealth" style="width: 0%"></div>
                    </div>
                    <p id="healthMetrics">Analyzing pipeline...</p>
                </div>

                <div class="analytics-card">
                    <h3>Response Rate by Channel</h3>
                    <div id="channelMetrics">
                        <div class="detail-row">
                            <span>Email:</span>
                            <span id="emailRate">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>LinkedIn:</span>
                            <span id="linkedinRate">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>Warm Intro:</span>
                            <span id="warmIntroRate">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>Event/Demo:</span>
                            <span id="eventRate">0%</span>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3>Stage Conversion</h3>
                    <div id="conversionMetrics">
                        <div class="detail-row">
                            <span>Contact â†’ Meeting:</span>
                            <span id="contactToMeeting">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>Meeting â†’ Pitch:</span>
                            <span id="meetingToPitch">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>Pitch â†’ DD:</span>
                            <span id="pitchToDD">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>DD â†’ Term Sheet:</span>
                            <span id="ddToTerm">0%</span>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3>Monthly Performance</h3>
                    <div id="monthlyMetrics">
                        <div class="detail-row">
                            <span>New Contacts:</span>
                            <span id="newContacts">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Meetings Booked:</span>
                            <span id="meetingsBooked">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Pitches Sent:</span>
                            <span id="pitchesSent">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Deals Closed:</span>
                            <span id="dealsClosed">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="export-section">
            <h3>Export & Backup</h3>
            <p style="margin-bottom: 15px;">Download your investor data and analytics for external use or backup purposes.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn-secondary" onclick="exportData('investors')">Export Investors (CSV)</button>
                <button class="btn-secondary" onclick="exportData('pipeline')">Export Pipeline (CSV)</button>
                <button class="btn-secondary" onclick="exportData('interactions')">Export Interactions (CSV)</button>
                <button class="btn-secondary" onclick="exportData('analytics')">Export Analytics Report (PDF)</button>
                <button class="btn" onclick="backupData()">Backup All Data</button>
            </div>
        </div>
    </div>

    <!-- Add Investor Modal -->
    <div id="addInvestorModal" class="modal">
        <div class="modal-content">
            <h2>Add New Investor</h2>
            <form id="addInvestorForm">
                <div class="form-group">
                    <label for="investorName">Investor/Fund Name *</label>
                    <input type="text" id="investorName" required>
                </div>
                
                <div class="form-group">
                    <label for="contactPerson">Contact Person</label>
                    <input type="text" id="contactPerson">
                </div>
                
                <div class="form-group">
                    <label for="investorType">Type *</label>
                    <select id="investorType" required>
                        <option value="">Select Type</option>
                        <option value="angel">Angel Investor</option>
                        <option value="vc">VC Fund</option>
                        <option value="family_office">Family Office</option>
                        <option value="government">Government</option>
                        <option value="corporate">Corporate VC</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="investmentRange">Investment Range (â‚¹)</label>
                    <input type="text" id="investmentRange" placeholder="e.g., 25L - 2Cr">
                </div>
                
                <div class="form-group">
                    <label for="sector">Sector Focus</label>
                    <input type="text" id="sector" placeholder="e.g., Fintech, Healthcare, SaaS">
                </div>
                
                <div class="form-group">
                    <label for="stage">Current Stage</label>
                    <select id="stage">
                        <option value="research">Research</option>
                        <option value="contacted">Contacted</option>
                        <option value="meeting_scheduled">Meeting Scheduled</option>
                        <option value="pitch_sent">Pitch Sent</option>
                        <option value="due_diligence">Due Diligence</option>
                        <option value="term_sheet">Term Sheet</option>
                        <option value="closed">Closed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email">
                </div>
                
                <div class="form-group">
                    <label for="linkedin">LinkedIn Profile</label>
                    <input type="url" id="linkedin">
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" placeholder="Additional notes about this investor..."></textarea>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                    <button type="button" class="btn-secondary" onclick="closeModal('addInvestorModal')">Cancel</button>
                    <button type="submit" class="btn">Add Investor</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global data storage
        let investors = JSON.parse(localStorage.getItem('p3_investors') || '[]');
        let pipeline = JSON.parse(localStorage.getItem('p3_pipeline') || '[]');
        let interactions = JSON.parse(localStorage.getItem('p3_interactions') || '[]');

        // Initialize with sample data if empty
        if (investors.length === 0) {
            initializeSampleData();
        }

        // Initialize the CRM
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderInvestors();
            renderPipeline();
            renderInteractions();
            updateAnalytics();
        });

        function initializeSampleData() {
            const sampleInvestors = [
                {
                    id: 'inv_001',
                    name: 'Sequoia Capital India',
                    contactPerson: 'Rajan Anandan',
                    type: 'vc',
                    investmentRange: '2Cr - 50Cr',
                    sector: 'Tech, Consumer',
                    stage: 'research',
                    email: 'india@sequoiacap.com',
                    linkedin: 'https://linkedin.com/company/sequoia-capital',
                    notes: 'Focus on Series A and beyond. Strong tech portfolio.',
                    dateAdded: new Date().toISOString(),
                    interactions: []
                },
                {
                    id: 'inv_002',
                    name: 'Kalaari Capital',
                    contactPerson: 'Vani Kola',
                    type: 'vc',
                    investmentRange: '25L - 10Cr',
                    sector: 'Fintech, SaaS',
                    stage: 'contacted',
                    email: 'team@kalaari.com',
                    linkedin: 'https://linkedin.com/company/kalaari-capital',
                    notes: 'Early stage focus. Good for Seed to Series A.',
                    dateAdded: new Date().toISOString(),
                    interactions: [
                        {
                            date: new Date().toISOString(),
                            type: 'email',
                            notes: 'Sent initial pitch deck via email'
                        }
                    ]
                },
                {
                    id: 'inv_003',
                    name: 'Ratan Tata',
                    contactPerson: 'Ratan Tata',
                    type: 'angel',
                    investmentRange: '25L - 2Cr',
                    sector: 'Consumer, Social Impact',
                    stage: 'meeting_scheduled',
                    email: 'office@ratantata.com',
                    linkedin: 'https://linkedin.com/in/ratan-tata',
                    notes: 'Strategic angel investor. Focuses on consumer impact.',
                    dateAdded: new Date().toISOString(),
                    interactions: [
                        {
                            date: new Date().toISOString(),
                            type: 'warm_intro',
                            notes: 'Introduced through mutual connection'
                        },
                        {
                            date: new Date(Date.now() - 86400000).toISOString(),
                            type: 'call',
                            notes: 'Initial 15-min call. Positive response.'
                        }
                    ]
                }
            ];

            investors = sampleInvestors;
            localStorage.setItem('p3_investors', JSON.stringify(investors));

            // Add sample pipeline data
            pipeline = [
                {
                    id: 'deal_001',
                    investorId: 'inv_003',
                    amount: '1Cr',
                    stage: 'meeting_scheduled',
                    probability: 60,
                    expectedClose: '2024-10-15',
                    lastContact: new Date().toISOString()
                },
                {
                    id: 'deal_002',
                    investorId: 'inv_002',
                    amount: '50L',
                    stage: 'pitch_sent',
                    probability: 30,
                    expectedClose: '2024-11-30',
                    lastContact: new Date(Date.now() - 86400000).toISOString()
                }
            ];
            localStorage.setItem('p3_pipeline', JSON.stringify(pipeline));
        }

        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Refresh content based on tab
            switch(tabName) {
                case 'investors':
                    renderInvestors();
                    break;
                case 'pipeline':
                    renderPipeline();
                    break;
                case 'interactions':
                    renderInteractions();
                    break;
                case 'analytics':
                    updateAnalytics();
                    break;
            }
        }

        function updateStats() {
            const totalInvestors = investors.length;
            const activeDeals = pipeline.filter(deal => 
                ['meeting_scheduled', 'pitch_sent', 'due_diligence', 'term_sheet'].includes(deal.stage)
            ).length;
            
            const totalCommitted = pipeline
                .filter(deal => deal.stage === 'closed')
                .reduce((sum, deal) => sum + parseFloat(deal.amount.replace(/[^0-9.]/g, '')), 0);
            
            const avgResponseTime = calculateAverageResponseTime();
            const conversionRate = calculateConversionRate();

            document.getElementById('totalInvestors').textContent = totalInvestors;
            document.getElementById('activeDeals').textContent = activeDeals;
            document.getElementById('totalCommitted').textContent = `â‚¹${totalCommitted}L`;
            document.getElementById('avgResponseTime').textContent = avgResponseTime;
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
        }

        function calculateAverageResponseTime() {
            const responses = interactions.filter(int => int.type === 'response');
            if (responses.length === 0) return '0';
            
            const avgDays = responses.reduce((sum, response) => {
                const daysSinceContact = Math.floor((new Date(response.date) - new Date(response.contactDate)) / (1000 * 60 * 60 * 24));
                return sum + daysSinceContact;
            }, 0) / responses.length;
            
            return Math.round(avgDays);
        }

        function calculateConversionRate() {
            const totalContacted = investors.filter(inv => inv.stage !== 'research').length;
            const totalClosed = investors.filter(inv => inv.stage === 'closed').length;
            
            if (totalContacted === 0) return 0;
            return Math.round((totalClosed / totalContacted) * 100);
        }

        function renderInvestors() {
            const grid = document.getElementById('investorsGrid');
            grid.innerHTML = '';
            
            const filteredInvestors = getFilteredInvestors();
            
            filteredInvestors.forEach(investor => {
                const card = createInvestorCard(investor);
                grid.appendChild(card);
            });
        }

        function getFilteredInvestors() {
            const search = document.getElementById('searchInvestors')?.value?.toLowerCase() || '';
            const stageFilter = document.getElementById('stageFilter')?.value || '';
            const typeFilter = document.getElementById('typeFilter')?.value || '';
            
            return investors.filter(investor => {
                const matchesSearch = !search || 
                    investor.name.toLowerCase().includes(search) ||
                    investor.contactPerson?.toLowerCase().includes(search) ||
                    investor.sector?.toLowerCase().includes(search);
                    
                const matchesStage = !stageFilter || investor.stage === stageFilter;
                const matchesType = !typeFilter || investor.type === typeFilter;
                
                return matchesSearch && matchesStage && matchesType;
            });
        }

        function createInvestorCard(investor) {
            const card = document.createElement('div');
            card.className = 'investor-card';
            
            const lastInteraction = investor.interactions?.length > 0 
                ? new Date(investor.interactions[investor.interactions.length - 1].date).toLocaleDateString()
                : 'No interactions';
            
            card.innerHTML = `
                <div class="investor-header">
                    <div class="investor-info">
                        <h3>${investor.name}</h3>
                        <p>${investor.contactPerson || 'No contact person'}</p>
                    </div>
                    <div class="stage-badge ${getStageClass(investor.stage)}">${formatStage(investor.stage)}</div>
                </div>
                
                <div class="investor-details">
                    <div class="detail-row">
                        <span>Type:</span>
                        <span>${formatType(investor.type)}</span>
                    </div>
                    <div class="detail-row">
                        <span>Investment Range:</span>
                        <span>${investor.investmentRange || 'Not specified'}</span>
                    </div>
                    <div class="detail-row">
                        <span>Sector Focus:</span>
                        <span>${investor.sector || 'General'}</span>
                    </div>
                    <div class="detail-row">
                        <span>Last Contact:</span>
                        <span>${lastInteraction}</span>
                    </div>
                </div>
                
                <div class="interaction-timeline">
                    ${investor.interactions?.slice(-3).map(interaction => `
                        <div class="timeline-item">
                            <strong>${formatInteractionType(interaction.type)}</strong> - ${new Date(interaction.date).toLocaleDateString()}
                            <br><small>${interaction.notes}</small>
                        </div>
                    `).join('') || '<p style="font-size: 12px; opacity: 0.7;">No interactions recorded</p>'}
                </div>
                
                <div class="card-actions">
                    <button class="btn-secondary" onclick="logNewInteraction('${investor.id}')">Log Contact</button>
                    <button class="btn-secondary" onclick="editInvestor('${investor.id}')">Edit</button>
                    <button class="btn" onclick="moveToNextStage('${investor.id}')">Next Stage</button>
                </div>
            `;
            
            return card;
        }

        function getStageClass(stage) {
            const stageClasses = {
                'research': 'cold',
                'contacted': 'cold',
                'meeting_scheduled': 'warm',
                'pitch_sent': 'warm',
                'due_diligence': 'hot',
                'term_sheet': 'hot',
                'closed': 'hot',
                'rejected': 'cold'
            };
            return stageClasses[stage] || 'cold';
        }

        function formatStage(stage) {
            const stages = {
                'research': 'Research',
                'contacted': 'Contacted',
                'meeting_scheduled': 'Meeting Scheduled',
                'pitch_sent': 'Pitch Sent',
                'due_diligence': 'Due Diligence',
                'term_sheet': 'Term Sheet',
                'closed': 'Closed',
                'rejected': 'Rejected'
            };
            return stages[stage] || stage;
        }

        function formatType(type) {
            const types = {
                'angel': 'Angel Investor',
                'vc': 'VC Fund',
                'family_office': 'Family Office',
                'government': 'Government',
                'corporate': 'Corporate VC'
            };
            return types[type] || type;
        }

        function formatInteractionType(type) {
            const types = {
                'email': 'Email',
                'call': 'Call',
                'meeting': 'Meeting',
                'linkedin': 'LinkedIn',
                'warm_intro': 'Warm Intro',
                'event': 'Event',
                'response': 'Response'
            };
            return types[type] || type;
        }

        function filterInvestors() {
            renderInvestors();
        }

        function openAddInvestorModal() {
            document.getElementById('addInvestorModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Form submission for adding investors
        document.getElementById('addInvestorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newInvestor = {
                id: 'inv_' + Date.now(),
                name: document.getElementById('investorName').value,
                contactPerson: document.getElementById('contactPerson').value,
                type: document.getElementById('investorType').value,
                investmentRange: document.getElementById('investmentRange').value,
                sector: document.getElementById('sector').value,
                stage: document.getElementById('stage').value,
                email: document.getElementById('email').value,
                linkedin: document.getElementById('linkedin').value,
                notes: document.getElementById('notes').value,
                dateAdded: new Date().toISOString(),
                interactions: []
            };
            
            investors.push(newInvestor);
            localStorage.setItem('p3_investors', JSON.stringify(investors));
            
            closeModal('addInvestorModal');
            document.getElementById('addInvestorForm').reset();
            renderInvestors();
            updateStats();
        });

        function logNewInteraction(investorId) {
            const type = prompt('Interaction type (email/call/meeting/linkedin/warm_intro/event):');
            const notes = prompt('Notes about this interaction:');
            
            if (type && notes) {
                const investor = investors.find(inv => inv.id === investorId);
                if (investor) {
                    investor.interactions.push({
                        date: new Date().toISOString(),
                        type: type,
                        notes: notes
                    });
                    
                    // Also add to global interactions log
                    interactions.push({
                        id: 'int_' + Date.now(),
                        investorId: investorId,
                        investorName: investor.name,
                        date: new Date().toISOString(),
                        type: type,
                        notes: notes
                    });
                    
                    localStorage.setItem('p3_investors', JSON.stringify(investors));
                    localStorage.setItem('p3_interactions', JSON.stringify(interactions));
                    
                    renderInvestors();
                    updateStats();
                }
            }
        }

        function moveToNextStage(investorId) {
            const stageFlow = {
                'research': 'contacted',
                'contacted': 'meeting_scheduled',
                'meeting_scheduled': 'pitch_sent',
                'pitch_sent': 'due_diligence',
                'due_diligence': 'term_sheet',
                'term_sheet': 'closed'
            };
            
            const investor = investors.find(inv => inv.id === investorId);
            if (investor && stageFlow[investor.stage]) {
                investor.stage = stageFlow[investor.stage];
                
                // Add interaction for stage change
                investor.interactions.push({
                    date: new Date().toISOString(),
                    type: 'stage_change',
                    notes: `Moved to ${formatStage(investor.stage)} stage`
                });
                
                localStorage.setItem('p3_investors', JSON.stringify(investors));
                renderInvestors();
                updateStats();
            }
        }

        function renderPipeline() {
            const tbody = document.getElementById('pipelineTable');
            tbody.innerHTML = '';
            
            pipeline.forEach(deal => {
                const investor = investors.find(inv => inv.id === deal.investorId);
                if (!investor) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${investor.name}</td>
                    <td>â‚¹${deal.amount}</td>
                    <td>${formatStage(deal.stage)}</td>
                    <td>${deal.probability}%</td>
                    <td>${new Date(deal.expectedClose).toLocaleDateString()}</td>
                    <td>${new Date(deal.lastContact).toLocaleDateString()}</td>
                    <td>
                        <button class="btn-secondary" style="font-size: 10px; padding: 4px 8px;" onclick="updateDeal('${deal.id}')">Update</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderInteractions() {
            const container = document.getElementById('interactionsList');
            container.innerHTML = '';
            
            const sortedInteractions = interactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedInteractions.slice(0, 20).forEach(interaction => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <strong>${interaction.investorName}</strong> - ${formatInteractionType(interaction.type)}
                    <br><small>${new Date(interaction.date).toLocaleString()}</small>
                    <br><span style="font-size: 11px;">${interaction.notes}</span>
                `;
                container.appendChild(item);
            });
        }

        function updateAnalytics() {
            // Pipeline health calculation
            const activeDeals = pipeline.filter(deal => 
                ['meeting_scheduled', 'pitch_sent', 'due_diligence', 'term_sheet'].includes(deal.stage)
            );
            const healthScore = Math.round((activeDeals.length / Math.max(investors.length, 1)) * 100);
            
            document.getElementById('pipelineHealth').style.width = `${healthScore}%`;
            document.getElementById('healthMetrics').textContent = `${healthScore}% pipeline health (${activeDeals.length} active deals)`;
            
            // Response rates by channel
            const emailInteractions = interactions.filter(int => int.type === 'email').length;
            const linkedinInteractions = interactions.filter(int => int.type === 'linkedin').length;
            const warmIntroInteractions = interactions.filter(int => int.type === 'warm_intro').length;
            const eventInteractions = interactions.filter(int => int.type === 'event').length;
            
            const totalInteractions = interactions.length || 1;
            
            document.getElementById('emailRate').textContent = `${Math.round((emailInteractions / totalInteractions) * 100)}%`;
            document.getElementById('linkedinRate').textContent = `${Math.round((linkedinInteractions / totalInteractions) * 100)}%`;
            document.getElementById('warmIntroRate').textContent = `${Math.round((warmIntroInteractions / totalInteractions) * 100)}%`;
            document.getElementById('eventRate').textContent = `${Math.round((eventInteractions / totalInteractions) * 100)}%`;
            
            // Stage conversions
            const stageCount = {};
            investors.forEach(inv => {
                stageCount[inv.stage] = (stageCount[inv.stage] || 0) + 1;
            });
            
            const contactToMeeting = Math.round(((stageCount['meeting_scheduled'] || 0) / Math.max((stageCount['contacted'] || 0), 1)) * 100);
            const meetingToPitch = Math.round(((stageCount['pitch_sent'] || 0) / Math.max((stageCount['meeting_scheduled'] || 0), 1)) * 100);
            const pitchToDD = Math.round(((stageCount['due_diligence'] || 0) / Math.max((stageCount['pitch_sent'] || 0), 1)) * 100);
            const ddToTerm = Math.round(((stageCount['term_sheet'] || 0) / Math.max((stageCount['due_diligence'] || 0), 1)) * 100);
            
            document.getElementById('contactToMeeting').textContent = `${contactToMeeting}%`;
            document.getElementById('meetingToPitch').textContent = `${meetingToPitch}%`;
            document.getElementById('pitchToDD').textContent = `${pitchToDD}%`;
            document.getElementById('ddToTerm').textContent = `${ddToTerm}%`;
            
            // Monthly metrics (simplified for demo)
            document.getElementById('newContacts').textContent = investors.filter(inv => 
                new Date(inv.dateAdded) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)
            ).length;
            document.getElementById('meetingsBooked').textContent = stageCount['meeting_scheduled'] || 0;
            document.getElementById('pitchesSent').textContent = stageCount['pitch_sent'] || 0;
            document.getElementById('dealsClosed').textContent = stageCount['closed'] || 0;
        }

        function exportData(type) {
            let data, filename;
            
            switch(type) {
                case 'investors':
                    data = investors.map(inv => ({
                        Name: inv.name,
                        Contact: inv.contactPerson,
                        Type: inv.type,
                        Stage: inv.stage,
                        Investment_Range: inv.investmentRange,
                        Sector: inv.sector,
                        Email: inv.email,
                        Date_Added: new Date(inv.dateAdded).toLocaleDateString()
                    }));
                    filename = 'investors_export.csv';
                    break;
                    
                case 'pipeline':
                    data = pipeline.map(deal => {
                        const investor = investors.find(inv => inv.id === deal.investorId);
                        return {
                            Investor: investor?.name || 'Unknown',
                            Amount: deal.amount,
                            Stage: deal.stage,
                            Probability: deal.probability + '%',
                            Expected_Close: deal.expectedClose,
                            Last_Contact: new Date(deal.lastContact).toLocaleDateString()
                        };
                    });
                    filename = 'pipeline_export.csv';
                    break;
                    
                case 'interactions':
                    data = interactions.map(int => ({
                        Investor: int.investorName,
                        Date: new Date(int.date).toLocaleString(),
                        Type: int.type,
                        Notes: int.notes
                    }));
                    filename = 'interactions_export.csv';
                    break;
                    
                case 'analytics':
                    // For analytics, we'll create a simple report
                    const report = `
INVESTOR CRM ANALYTICS REPORT
Generated: ${new Date().toLocaleString()}

SUMMARY STATISTICS:
- Total Investors: ${investors.length}
- Active Deals: ${pipeline.filter(d => ['meeting_scheduled', 'pitch_sent', 'due_diligence', 'term_sheet'].includes(d.stage)).length}
- Conversion Rate: ${calculateConversionRate()}%
- Average Response Time: ${calculateAverageResponseTime()} days

STAGE BREAKDOWN:
${Object.entries(investors.reduce((acc, inv) => {
    acc[inv.stage] = (acc[inv.stage] || 0) + 1;
    return acc;
}, {})).map(([stage, count]) => `- ${formatStage(stage)}: ${count}`).join('\n')}

TYPE BREAKDOWN:
${Object.entries(investors.reduce((acc, inv) => {
    acc[inv.type] = (acc[inv.type] || 0) + 1;
    return acc;
}, {})).map(([type, count]) => `- ${formatType(type)}: ${count}`).join('\n')}
                    `;
                    
                    const blob = new Blob([report], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'analytics_report.txt';
                    a.click();
                    URL.revokeObjectURL(url);
                    return;
            }
            
            // Convert to CSV
            const csvContent = convertToCSV(data);
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function convertToCSV(data) {
            if (!data.length) return '';
            
            const headers = Object.keys(data[0]);
            const csvHeaders = headers.join(',');
            const csvRows = data.map(row => 
                headers.map(header => `"${(row[header] || '').toString().replace(/"/g, '""')}"`).join(',')
            );
            
            return [csvHeaders, ...csvRows].join('\n');
        }

        function backupData() {
            const backup = {
                timestamp: new Date().toISOString(),
                investors: investors,
                pipeline: pipeline,
                interactions: interactions
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `investor_crm_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>